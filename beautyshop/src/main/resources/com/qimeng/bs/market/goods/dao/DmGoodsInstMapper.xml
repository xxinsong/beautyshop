<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.qimeng.bs.market.goods.dao.DmGoodsInstMapper">
  <resultMap id="BaseResultMap" type="com.qimeng.bs.market.goods.bean.DmGoodsInst">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Dec 23 11:20:09 CST 2013.
    -->
    <id column="INST_ID" jdbcType="INTEGER" property="instId" />
    <result column="MERCHANT_ID" jdbcType="INTEGER" property="merchantId" />
    <result column="GOODS_ID" jdbcType="INTEGER" property="goodsId" />
    <result column="PLAN_ID" jdbcType="INTEGER" property="planId" />
    <result column="GOODS_NAME" jdbcType="VARCHAR" property="goodsName" />
    <result column="GOODS_TYPE" jdbcType="VARCHAR" property="goodsType" />
    <result column="DATA_START_TIME" jdbcType="TIMESTAMP" property="dataStartTime" />
    <result column="DATA_END_TIME" jdbcType="TIMESTAMP" property="dataEndTime" />
    <result column="MAX_NUM" jdbcType="INTEGER" property="maxNum" />
    <result column="EFF_DATE" jdbcType="TIMESTAMP" property="effDate" />
    <result column="EXP_DATE" jdbcType="TIMESTAMP" property="expDate" />
    <result column="STATE" jdbcType="VARCHAR" property="state" />
  </resultMap>

    <resultMap id="GoodsInstMap" type="com.qimeng.bs.market.goods.bean.DmGoodsInst">
        <id column="INST_ID" jdbcType="INTEGER" property="instId" />
        <result column="MERCHANT_ID" jdbcType="INTEGER" property="merchantId" />
        <result column="GOODS_ID" jdbcType="INTEGER" property="goodsId" />
        <result column="PLAN_ID" jdbcType="INTEGER" property="planId" />
        <result column="GOODS_NAME" jdbcType="VARCHAR" property="goodsName" />
        <result column="GOODS_TYPE" jdbcType="VARCHAR" property="goodsType" />
        <result column="DATA_START_TIME" jdbcType="TIMESTAMP" property="dataStartTime" />
        <result column="DATA_END_TIME" jdbcType="TIMESTAMP" property="dataEndTime" />
        <result column="MAX_NUM" jdbcType="INTEGER" property="maxNum" />
        <result column="EFF_DATE" jdbcType="TIMESTAMP" property="effDate" />
        <result column="EXP_DATE" jdbcType="TIMESTAMP" property="expDate" />
        <result column="STATE" jdbcType="VARCHAR" property="state" />
        <association property="dmGoodsPlan" resultMap="GoodsPlanMap"/>
    </resultMap>
    <resultMap id="GoodsPlanMap" type="com.qimeng.bs.admin.goods.bean.DmGoodsPlan" >
        <id column="PLAN_ID" property="planId" jdbcType="INTEGER" />
        <result column="GOODS_ID" property="goodsId" jdbcType="INTEGER" />
        <result column="PLAN_NAME" property="planName" jdbcType="VARCHAR" />
        <result column="PLAN_INTRO" property="planIntro" jdbcType="VARCHAR" />
        <result column="PLAN_PRICE" property="planPrice" jdbcType="REAL" />
        <result column="PLAN_SHOW_PRICE" property="planShowPrice" jdbcType="REAL" />
        <result column="PLAN_DESC" property="planDesc" jdbcType="VARCHAR" />
        <result column="EFF_DATE" property="effDate" jdbcType="TIMESTAMP" />
        <result column="EXP_DATE" property="expDate" jdbcType="TIMESTAMP" />
        <result column="STATE_DATE" property="stateDate" jdbcType="TIMESTAMP" />
        <result column="OPER_STAFF_ID" property="operStaffId" jdbcType="VARCHAR" />
        <result column="OPER_STAFF_NAME" property="operStaffName" jdbcType="VARCHAR" />
        <result column="PLAN_TYPE" property="planType" jdbcType="VARCHAR" />
        <result column="STATE" property="state" jdbcType="VARCHAR" />
    </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Dec 23 11:20:09 CST 2013.
    -->
    INST_ID, MERCHANT_ID, GOODS_ID, PLAN_ID, GOODS_NAME, GOODS_TYPE, DATA_START_TIME, 
    DATA_END_TIME, MAX_NUM, EFF_DATE, EXP_DATE, STATE
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Dec 23 11:20:09 CST 2013.
    -->
    select 
    <include refid="Base_Column_List" />
    from dm_goods_inst
    where INST_ID = #{instId,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Dec 23 11:20:09 CST 2013.
    -->
    delete from dm_goods_inst
    where INST_ID = #{instId,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.qimeng.bs.market.goods.bean.DmGoodsInst">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Dec 23 11:20:09 CST 2013.
    -->
    insert into dm_goods_inst (INST_ID, MERCHANT_ID, GOODS_ID, 
      PLAN_ID, GOODS_NAME, GOODS_TYPE, 
      DATA_START_TIME, DATA_END_TIME, MAX_NUM, 
      EFF_DATE, EXP_DATE, STATE
      )
    values (#{instId,jdbcType=INTEGER}, #{merchantId,jdbcType=INTEGER}, #{goodsId,jdbcType=INTEGER}, 
      #{planId,jdbcType=INTEGER}, #{goodsName,jdbcType=VARCHAR}, #{goodsType,jdbcType=VARCHAR}, 
      #{dataStartTime,jdbcType=TIMESTAMP}, #{dataEndTime,jdbcType=TIMESTAMP}, #{maxNum,jdbcType=INTEGER}, 
      #{effDate,jdbcType=TIMESTAMP}, #{expDate,jdbcType=TIMESTAMP}, #{state,jdbcType=VARCHAR}
      )
  </insert>
  <insert id="insertSelective" parameterType="com.qimeng.bs.market.goods.bean.DmGoodsInst">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Dec 23 11:20:09 CST 2013.
    -->
    insert into dm_goods_inst
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="instId != null">
        INST_ID,
      </if>
      <if test="merchantId != null">
        MERCHANT_ID,
      </if>
      <if test="goodsId != null">
        GOODS_ID,
      </if>
      <if test="planId != null">
        PLAN_ID,
      </if>
      <if test="goodsName != null">
        GOODS_NAME,
      </if>
      <if test="goodsType != null">
        GOODS_TYPE,
      </if>
      <if test="dataStartTime != null">
        DATA_START_TIME,
      </if>
      <if test="dataEndTime != null">
        DATA_END_TIME,
      </if>
      <if test="maxNum != null">
        MAX_NUM,
      </if>
      <if test="effDate != null">
        EFF_DATE,
      </if>
      <if test="expDate != null">
        EXP_DATE,
      </if>
      <if test="state != null">
        STATE,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="instId != null">
        #{instId,jdbcType=INTEGER},
      </if>
      <if test="merchantId != null">
        #{merchantId,jdbcType=INTEGER},
      </if>
      <if test="goodsId != null">
        #{goodsId,jdbcType=INTEGER},
      </if>
      <if test="planId != null">
        #{planId,jdbcType=INTEGER},
      </if>
      <if test="goodsName != null">
        #{goodsName,jdbcType=VARCHAR},
      </if>
      <if test="goodsType != null">
        #{goodsType,jdbcType=VARCHAR},
      </if>
      <if test="dataStartTime != null">
        #{dataStartTime,jdbcType=TIMESTAMP},
      </if>
      <if test="dataEndTime != null">
        #{dataEndTime,jdbcType=TIMESTAMP},
      </if>
      <if test="maxNum != null">
        #{maxNum,jdbcType=INTEGER},
      </if>
      <if test="effDate != null">
        #{effDate,jdbcType=TIMESTAMP},
      </if>
      <if test="expDate != null">
        #{expDate,jdbcType=TIMESTAMP},
      </if>
      <if test="state != null">
        #{state,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.qimeng.bs.market.goods.bean.DmGoodsInst">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Dec 23 11:20:09 CST 2013.
    -->
    update dm_goods_inst
    <set>
      <if test="merchantId != null">
        MERCHANT_ID = #{merchantId,jdbcType=INTEGER},
      </if>
      <if test="goodsId != null">
        GOODS_ID = #{goodsId,jdbcType=INTEGER},
      </if>
      <if test="planId != null">
        PLAN_ID = #{planId,jdbcType=INTEGER},
      </if>
      <if test="goodsName != null">
        GOODS_NAME = #{goodsName,jdbcType=VARCHAR},
      </if>
      <if test="goodsType != null">
        GOODS_TYPE = #{goodsType,jdbcType=VARCHAR},
      </if>
      <if test="dataStartTime != null">
        DATA_START_TIME = #{dataStartTime,jdbcType=TIMESTAMP},
      </if>
      <if test="dataEndTime != null">
        DATA_END_TIME = #{dataEndTime,jdbcType=TIMESTAMP},
      </if>
      <if test="maxNum != null">
        MAX_NUM = #{maxNum,jdbcType=INTEGER},
      </if>
      <if test="effDate != null">
        EFF_DATE = #{effDate,jdbcType=TIMESTAMP},
      </if>
      <if test="expDate != null">
        EXP_DATE = #{expDate,jdbcType=TIMESTAMP},
      </if>
      <if test="state != null">
        STATE = #{state,jdbcType=VARCHAR},
      </if>
    </set>
    where INST_ID = #{instId,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.qimeng.bs.market.goods.bean.DmGoodsInst">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Dec 23 11:20:09 CST 2013.
    -->
    update dm_goods_inst
    set MERCHANT_ID = #{merchantId,jdbcType=INTEGER},
      GOODS_ID = #{goodsId,jdbcType=INTEGER},
      PLAN_ID = #{planId,jdbcType=INTEGER},
      GOODS_NAME = #{goodsName,jdbcType=VARCHAR},
      GOODS_TYPE = #{goodsType,jdbcType=VARCHAR},
      DATA_START_TIME = #{dataStartTime,jdbcType=TIMESTAMP},
      DATA_END_TIME = #{dataEndTime,jdbcType=TIMESTAMP},
      MAX_NUM = #{maxNum,jdbcType=INTEGER},
      EFF_DATE = #{effDate,jdbcType=TIMESTAMP},
      EXP_DATE = #{expDate,jdbcType=TIMESTAMP},
      STATE = #{state,jdbcType=VARCHAR}
    where INST_ID = #{instId,jdbcType=INTEGER}
  </update>
    <select id="queryAvailableGoodsInst" parameterType="java.util.Map" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List" />
        from dm_goods_inst
        where MERCHANT_ID = #{merchantId,jdbcType=INTEGER}
          and STATE = '00R'
          and TO_DAYS(exp_date) &gt; TO_DAYS(now())
        <if test="checkedInstId != null">
            or inst_id = #{checkedInstId}
        </if>
    </select>
    <select id="selectGoodsInstAndPrice" resultMap="GoodsInstMap" parameterType="java.lang.Integer">
      select
        A.INST_ID,
        A.MERCHANT_ID,
        A.GOODS_ID,
        A.PLAN_ID,
        A.GOODS_NAME,
        A.GOODS_TYPE,
        A.DATA_START_TIME,
        A.DATA_END_TIME,
        A.MAX_NUM,
        A.EFF_DATE,
        A.EXP_DATE,
        A.STATE,
        C.PLAN_NAME,
        C.PLAN_INTRO,
        C.PLAN_PRICE,
        C.PLAN_SHOW_PRICE
      from dm_goods_inst A left join DM_GOODS_PLAN C ON A.PLAN_ID = C.PLAN_ID
      where INST_ID = #{instId,jdbcType=INTEGER}
    </select>
</mapper>