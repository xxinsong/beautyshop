<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.qimeng.bs.market.goods.dao.DmGoodsInstMapper">
  <resultMap id="BaseResultMap" type="com.qimeng.bs.market.goods.bean.DmGoodsInst">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sun Jan 05 18:38:04 CST 2014.
    -->
    <id column="INST_ID" jdbcType="INTEGER" property="instId" />
    <result column="MERCHANT_ID" jdbcType="INTEGER" property="merchantId" />
    <result column="GOODS_ID" jdbcType="INTEGER" property="goodsId" />
    <result column="GOODS_NAME" jdbcType="VARCHAR" property="goodsName" />
    <result column="GOODS_TYPE" jdbcType="VARCHAR" property="goodsType" />
    <result column="PLAN_ID" jdbcType="INTEGER" property="planId" />
    <result column="PRICE" jdbcType="REAL" property="price" />
    <result column="INST_NUM" jdbcType="INTEGER" property="instNum" />
    <result column="STATE" jdbcType="VARCHAR" property="state" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sun Jan 05 18:38:04 CST 2014.
    -->
    INST_ID, MERCHANT_ID, GOODS_ID, GOODS_NAME, GOODS_TYPE, PLAN_ID, PRICE, INST_NUM, 
    STATE
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sun Jan 05 18:38:04 CST 2014.
    -->
    select 
    <include refid="Base_Column_List" />
    from dm_goods_inst
    where INST_ID = #{instId,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sun Jan 05 18:38:04 CST 2014.
    -->
    delete from dm_goods_inst
    where INST_ID = #{instId,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.qimeng.bs.market.goods.bean.DmGoodsInst">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sun Jan 05 18:38:04 CST 2014.
    -->
    insert into dm_goods_inst (INST_ID, MERCHANT_ID, GOODS_ID, 
      GOODS_NAME, GOODS_TYPE, PLAN_ID, 
      PRICE, INST_NUM, STATE)
    values (#{instId,jdbcType=INTEGER}, #{merchantId,jdbcType=INTEGER}, #{goodsId,jdbcType=INTEGER}, 
      #{goodsName,jdbcType=VARCHAR}, #{goodsType,jdbcType=VARCHAR}, #{planId,jdbcType=INTEGER}, 
      #{price,jdbcType=REAL}, #{instNum,jdbcType=INTEGER}, #{state,jdbcType=VARCHAR})
  </insert>
  <insert id="insertSelective" parameterType="com.qimeng.bs.market.goods.bean.DmGoodsInst">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sun Jan 05 18:38:04 CST 2014.
    -->
    insert into dm_goods_inst
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="instId != null">
        INST_ID,
      </if>
      <if test="merchantId != null">
        MERCHANT_ID,
      </if>
      <if test="goodsId != null">
        GOODS_ID,
      </if>
      <if test="goodsName != null">
        GOODS_NAME,
      </if>
      <if test="goodsType != null">
        GOODS_TYPE,
      </if>
      <if test="planId != null">
        PLAN_ID,
      </if>
      <if test="price != null">
        PRICE,
      </if>
      <if test="instNum != null">
        INST_NUM,
      </if>
      <if test="state != null">
        STATE,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="instId != null">
        #{instId,jdbcType=INTEGER},
      </if>
      <if test="merchantId != null">
        #{merchantId,jdbcType=INTEGER},
      </if>
      <if test="goodsId != null">
        #{goodsId,jdbcType=INTEGER},
      </if>
      <if test="goodsName != null">
        #{goodsName,jdbcType=VARCHAR},
      </if>
      <if test="goodsType != null">
        #{goodsType,jdbcType=VARCHAR},
      </if>
      <if test="planId != null">
        #{planId,jdbcType=INTEGER},
      </if>
      <if test="price != null">
        #{price,jdbcType=REAL},
      </if>
      <if test="instNum != null">
        #{instNum,jdbcType=INTEGER},
      </if>
      <if test="state != null">
        #{state,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.qimeng.bs.market.goods.bean.DmGoodsInst">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sun Jan 05 18:38:04 CST 2014.
    -->
    update dm_goods_inst
    <set>
      <if test="merchantId != null">
        MERCHANT_ID = #{merchantId,jdbcType=INTEGER},
      </if>
      <if test="goodsId != null">
        GOODS_ID = #{goodsId,jdbcType=INTEGER},
      </if>
      <if test="goodsName != null">
        GOODS_NAME = #{goodsName,jdbcType=VARCHAR},
      </if>
      <if test="goodsType != null">
        GOODS_TYPE = #{goodsType,jdbcType=VARCHAR},
      </if>
      <if test="planId != null">
        PLAN_ID = #{planId,jdbcType=INTEGER},
      </if>
      <if test="price != null">
        PRICE = #{price,jdbcType=REAL},
      </if>
      <if test="instNum != null">
        INST_NUM = #{instNum,jdbcType=INTEGER},
      </if>
      <if test="state != null">
        STATE = #{state,jdbcType=VARCHAR},
      </if>
    </set>
    where INST_ID = #{instId,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.qimeng.bs.market.goods.bean.DmGoodsInst">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sun Jan 05 18:38:04 CST 2014.
    -->
    update dm_goods_inst
    set MERCHANT_ID = #{merchantId,jdbcType=INTEGER},
      GOODS_ID = #{goodsId,jdbcType=INTEGER},
      GOODS_NAME = #{goodsName,jdbcType=VARCHAR},
      GOODS_TYPE = #{goodsType,jdbcType=VARCHAR},
      PLAN_ID = #{planId,jdbcType=INTEGER},
      PRICE = #{price,jdbcType=REAL},
      INST_NUM = #{instNum,jdbcType=INTEGER},
      STATE = #{state,jdbcType=VARCHAR}
    where INST_ID = #{instId,jdbcType=INTEGER}
  </update>

    <resultMap id="GoodsInstMap" type="com.qimeng.bs.market.goods.bean.DmGoodsInst">
        <id column="INST_ID" jdbcType="INTEGER" property="instId" />
        <result column="MERCHANT_ID" jdbcType="INTEGER" property="merchantId" />
        <result column="GOODS_ID" jdbcType="INTEGER" property="goodsId" />
        <result column="PLAN_ID" jdbcType="INTEGER" property="planId" />
        <result column="GOODS_NAME" jdbcType="VARCHAR" property="goodsName" />
        <result column="GOODS_TYPE" jdbcType="VARCHAR" property="goodsType" />
        <result column="STATE" jdbcType="VARCHAR" property="state" />
    </resultMap>
    <resultMap id="GoodsPlanMap" type="com.qimeng.bs.admin.goods.bean.DmGoodsPlan">
        <id column="PLAN_ID" jdbcType="INTEGER" property="planId" />
        <result column="GOODS_ID" jdbcType="INTEGER" property="goodsId" />
        <result column="PLAN_NAME" jdbcType="VARCHAR" property="planName" />
        <result column="PLAN_INTRO" jdbcType="VARCHAR" property="planIntro" />
        <result column="PLAN_PRICE" jdbcType="REAL" property="planPrice" />
        <result column="PLAN_SHOW_PRICE" jdbcType="REAL" property="planShowPrice" />
        <result column="PLAN_DESC" jdbcType="VARCHAR" property="planDesc" />
        <result column="EFF_DATE" jdbcType="TIMESTAMP" property="effDate" />
        <result column="EXP_DATE" jdbcType="TIMESTAMP" property="expDate" />
        <result column="STATE_DATE" jdbcType="TIMESTAMP" property="stateDate" />
        <result column="OPER_STAFF_ID" jdbcType="VARCHAR" property="operStaffId" />
        <result column="OPER_STAFF_NAME" jdbcType="VARCHAR" property="operStaffName" />
        <result column="PLAN_TYPE" jdbcType="VARCHAR" property="planType" />
        <result column="STATE" jdbcType="VARCHAR" property="state" />
    </resultMap>
    <select id="queryAvailableGoodsInst" parameterType="java.util.Map" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List" />
        from dm_goods_inst
        where MERCHANT_ID = #{merchantId,jdbcType=INTEGER}
          and STATE = '00R'
          and TO_DAYS(exp_date) &gt; TO_DAYS(now())
        <if test="checkedInstId != null">
            or inst_id = #{checkedInstId}
        </if>
    </select>
    <select id="selectGoodsInstAndPrice" parameterType="java.lang.Integer" resultMap="GoodsInstMap">
      select
        A.INST_ID,
        A.MERCHANT_ID,
        A.GOODS_ID,
        A.PLAN_ID,
        A.GOODS_NAME,
        A.GOODS_TYPE,
        A.DATA_START_TIME,
        A.DATA_END_TIME,
        A.MAX_NUM,
        A.EFF_DATE,
        A.EXP_DATE,
        A.STATE,
        C.PLAN_NAME,
        C.PLAN_INTRO,
        C.PLAN_PRICE,
        C.PLAN_SHOW_PRICE
      from dm_goods_inst A left join DM_GOODS_PLAN C ON A.PLAN_ID = C.PLAN_ID
      where INST_ID = #{instId,jdbcType=INTEGER}
    </select>
</mapper>